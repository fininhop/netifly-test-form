<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commande de Pain Bio</title>
    <link rel="icon" type="image/svg+xml" href="assets/bread-favicon.svg">
    <link href="assets/bootstrap-fallback.css" rel="stylesheet">
    <link href="assets/loader.css" rel="stylesheet">
    <link href="assets/theme.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#fff; padding:20px; padding-bottom:90px; line-height:1.6; min-height:100vh; }
        .form-container { width:100%; max-width:950px; margin:0 auto; background:#fff; padding:1.5rem; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.08); border:1px solid #e9ecef; }
        #clientOrderForm { width:100%; }
        h1 { color:#2c3e50; font-size:26px; font-weight:700; }
        .form-group { margin-bottom:25px; }
        .form-group label { display:block; font-weight:600; margin-bottom:8px; color:#2d3748; font-size:14px; letter-spacing:.2px; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="date"], textarea, select, .quantity-control input { width:100%; padding:12px; border:1px solid #e9ecef; border-radius:8px; font-size:14px; transition:border-color .2s, box-shadow .2s; background:#fff; }
        input:focus, textarea:focus { outline:none; border-color:#3498db; }
        .product-section { background:transparent; padding:0; border-radius:8px; margin:20px 0; }
        .basket-info { padding:12px; border-radius:10px; margin-bottom:20px; text-align:center; font-weight:500; border:1px solid; box-shadow:0 1px 4px rgba(0,0,0,0.06); }
        .basket-info.alert-info { background:#f0f7fb; border-color:#bee5eb; color:#0c5460; }
        .basket-info.alert-warning { background:#fff7e6; border-color:#ffc107; color:#856404; }
        .card { transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0,0,0,0.15) !important; }
        .radio-group { display:flex; gap:20px; margin-top:10px; }
        .radio-item { display:flex; align-items:center; gap:8px; }
        .submit-section { margin-top:32px; padding-top:24px; border-top:1px solid #e9ecef; }
        .submit-buttons { display:grid; grid-template-columns:1fr; gap:12px; margin-top:16px; }
        .submit-btn { padding:14px 22px; border:none; border-radius:10px; font-size:16px; font-weight:600; cursor:pointer; text-decoration:none; text-align:center; transition:.25s; display:flex; align-items:center; justify-content:center; gap:10px; background:linear-gradient(45deg,#3498db,#2980b9); color:#fff; box-shadow:0 3px 10px rgba(0,0,0,0.1); }
        .submit-btn:hover { transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,0.18); }
        .header-btn { padding:8px 16px; border:none; border-radius:6px; font-size:14px; font-weight:500; cursor:pointer; text-decoration:none; text-align:center; transition:.3s; display:flex; align-items:center; justify-content:center; gap:6px; background:linear-gradient(45deg,#3498db,#2980b9); color:#fff; }
        .header-btn:hover { transform:translateY(-1px); box-shadow:0 3px 10px rgba(0,0,0,0.15); }
        .header-btn-outline { padding:8px 16px; border:2px solid #3498db; border-radius:6px; font-size:14px; font-weight:500; cursor:pointer; text-decoration:none; text-align:center; transition:.3s; display:flex; align-items:center; justify-content:center; gap:6px; background:transparent; color:#3498db; }
        .header-btn-outline:hover { background:#3498db; color:#fff; transform:translateY(-1px); box-shadow:0 3px 10px rgba(0,0,0,0.15); }
        .submit-info { background:#e8f5e8; padding:14px; border-radius:10px; margin-bottom:16px; color:#27ae60; font-weight:500; text-align:center; box-shadow:0 1px 4px rgba(0,0,0,0.06); }
        .total-section { background:#f8f9fa; padding:16px; border-radius:12px; margin:20px 0; text-align:right; border:1px solid #e9ecef; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
        .total-amount { font-size:20px; font-weight:700; color:#2c3e50; }
        .status-message { padding:10px; border-radius:4px; margin-top:20px; font-weight:bold; text-align:center; }
        .success { background-color:#d4edda; color:#155724; }
        .error { background-color:#f8d7da; color:#721c24; }
        @media (max-width:768px){ 
            .form-container { margin:10px; padding:1.5rem; }
            h1 { font-size:22px; }
            .header-btn, .header-btn-outline { width:100%; }
        }
        .container { max-width: 950px; }
        /* Harmoniser l'accordÃ©on produits avec l'admin (ne pas modifier paddings/max-width) */
        #productGrid .accordion-item { 
            border:1px solid #e9ecef; 
            border-radius:12px; 
            overflow:hidden; 
            box-shadow:0 2px 8px rgba(0,0,0,0.08);
            margin-bottom:12px;
            background:#fff;
        }
        #productGrid .accordion-button { 
            background:linear-gradient(45deg,#f8f9fa,#e9ecef);
            font-weight:600; 
            color:#2d3748;
        }
        #productGrid .accordion-button:not(.collapsed){
            box-shadow: inset 0 -1px 0 rgba(0,0,0,0.125);
        }
        #productGrid .accordion-body { padding:16px; }
        /* Offcanvas panier modernisÃ© visuellement */
        .offcanvas-header { border-bottom:1px solid #e9ecef; }
        #basketItemsList .list-group-item { border:1px solid #e9ecef; border-radius:8px; margin-bottom:8px; }
        #floatingBasket { box-shadow:0 -4px 16px rgba(0,0,0,0.12); }
        /* CatÃ©gories produits (hover/focus) */
        .category-header {
            border:1px solid #e9ecef;
            border-radius:12px;
            padding:10px 14px;
            background:linear-gradient(45deg,#fdfdfd,#f7f9fa);
            transition:background .25s, box-shadow .25s, transform .25s, border-color .25s;
            position:relative;
        }
        .category-header:hover {
            background:linear-gradient(45deg,#eef6ff,#e3f2fd);
            border-color:#cfe2ff;
            box-shadow:0 4px 16px rgba(0,123,255,0.15);
            transform:translateY(-2px);
        }
        .category-header:focus-within {
            background:linear-gradient(45deg,#e9f5ff,#d8ecff);
            border-color:#91caff;
            box-shadow:0 0 0 0.2rem rgba(13,110,253,.25);
        }
        .category-header .category-toggle { color:#0d3b66; }
        .category-header .category-toggle:hover { text-decoration:underline; }
        .category-header button[data-role="toggle-arrow"] { transition:background .25s, transform .25s; }
        .category-header button[data-role="toggle-arrow"]:hover { background:#0d6efd; color:#fff; }
        .category-header button[data-role="toggle-arrow"][aria-expanded="true"] { background:#0d6efd; color:#fff; }
    </style>
</head>
<body>
    <div id="pageLoader"><div><div class="loader-spinner"></div><div id="pageLoaderText" class="loader-text">Chargementâ€¦</div></div></div>
    <div class="container">
        <div class="form-container mx-auto shadow-sm">
            <div class="app-header">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <div class="d-flex align-items-center gap-2">
                        <h1 class="app-title mb-0">Commande de pain bio cuits au feu de bois</h1>
                        <span class="badge bg-info text-dark">Client</span>
                    </div>
                    <div class="app-actions d-flex gap-2">
                        <a href="my-orders.html" class="btn btn-outline-primary">ðŸ“‹ Mes commandes</a>
                        <a href="profile.html" class="btn btn-outline-primary">ðŸ‘¤ Profil</a>
                        <button type="button" id="themeToggle" class="btn btn-outline-secondary" aria-label="Basculer le thÃ¨me">ðŸŒ™</button>
                        <a href="#" id="logoutLink" class="btn btn-primary">Se dÃ©connecter</a>
                    </div>
                </div>
            </div>
            <form id="clientOrderForm">
                
                <div class="form-group">
                    <label class="form-label fw-semibold">SÃ©lectionnez vos produits</label>
                    <div id="categoryControls" class="d-flex justify-content-end gap-2 mb-2" style="display:none;">
                        <button type="button" class="btn btn-sm btn-outline-primary" id="expandAllCategories">Tout ouvrir</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" id="collapseAllCategories">Tout fermer</button>
                    </div>
                    <div class="product-section">
                        <div class="basket-info" id="basket-info-message">Aucun produit dans votre panier.</div>
                        <div id="productGrid" class="mb-3"><!-- Products accordion will be injected here --></div>
                        <div class="total-section">
                            <div class="total-amount">Total: â‚¬ <span id="total-price">0.00</span></div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="seasonSelect" class="form-label fw-semibold">Saison de commande</label>
                    <select id="seasonSelect" name="season" required class="form-control">
                        <option value="">SÃ©lectionnez une saison...</option>
                    </select>
                    <small class="text-muted fst-italic">Choisissez la saison pour laquelle vous souhaitez commander</small>
                </div>
                
                <div id="statusMessage" class="status-message hidden"></div>
                <div class="submit-section">
                    <div class="submit-info">Votre commande sera enregistrÃ©e automatiquement.</div>
                    <div class="submit-buttons">
                        <button type="submit" class="submit-btn btn btn-primary">âœ… Valider ma commande</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Toast container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index:1070;">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Fermer"></button>
            </div>
            <div class="toast-body" id="toastBody"></div>
        </div>
    </div>

    <!-- Floating basket summary bar -->
    <div id="floatingBasket" class="position-fixed bottom-0 start-0 end-0 bg-primary text-white shadow-lg p-3 d-none" style="z-index:1030;">
        <div class="container d-flex justify-content-between align-items-center">
            <div>
                <strong id="floatBasketCount">0 produit(s)</strong>
                <span class="mx-2">|</span>
                <strong>Total: â‚¬ <span id="floatBasketTotal">0.00</span></strong>
            </div>
            <button type="button" class="btn btn-light btn-sm" data-bs-toggle="offcanvas" data-bs-target="#basketOffcanvas">
                ðŸ›’ Voir le panier
            </button>
        </div>
    </div>

    <!-- Offcanvas basket sidebar -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="basketOffcanvas" aria-labelledby="basketOffcanvasLabel">
        <div class="offcanvas-header bg-light">
            <h5 class="offcanvas-title" id="basketOffcanvasLabel">ðŸ›’ Votre Panier</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fermer"></button>
        </div>
        <div class="offcanvas-body">
            <div id="basketItemsList" class="mb-3">
                <p class="text-muted">Votre panier est vide.</p>
            </div>
            <hr>
            <div class="d-flex justify-content-between align-items-center mb-3">
                <strong>Total:</strong>
                <strong class="fs-5 text-success">â‚¬ <span id="offcanvasTotal">0.00</span></strong>
            </div>
            <div class="d-grid gap-2">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas" onclick="document.getElementById('clientOrderForm').scrollIntoView({behavior:'smooth'});">
                    Continuer la commande
                </button>
                <button type="button" id="offcanvasSubmitBtn" class="btn btn-success">
                    âœ… Valider ma commande
                </button>
            </div>
        </div>
    </div>

    <script src="assets/loader.js"></script>
    <script src="config.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
        <!-- Modal global messages -->
        <div class="modal fade" id="messageModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="messageModalTitle">Message</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                    </div>
                    <div class="modal-body" id="messageModalBody"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" onerror="(function(){var s=document.createElement('script');s.src='assets/bootstrap-lite.js';document.head.appendChild(s);})();"></script>
        <script>(function(){ if(!window.bootstrap){ var s=document.createElement('script'); s.src='assets/bootstrap-lite.js'; document.head.appendChild(s);} })();</script>
        <script src="assets/message-modal.js?v=20251127-1"></script>
        <script src="assets/theme.js"></script>
        
        <!-- Modal de confirmation Bootstrap (standardisÃ©) -->
        <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="confirmModalLabel">Confirmer l'action</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                    </div>
                    <div class="modal-body" id="confirmModalBody">ÃŠtes-vous sÃ»r ?</div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Non</button>
                        <button type="button" class="btn btn-danger" id="confirmModalYes">Oui</button>
                    </div>
                </div>
            </div>
        </div>
        <script src="script-client.js?v=20251128-2"></script>
</body>
</html>
